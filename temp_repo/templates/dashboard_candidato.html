{% extends 'base.html' %}

{% block title %}Dashboard - TalentMatch!{% endblock %}
{% block page_title %}Olá, {{ candidato.nome|default:user.username }}!{% endblock %}
{% block page_subtitle %}Seja bem-vindo ao seu painel de controle{% endblock %}
{% block user_role %}Candidato{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<!-- Ação Rápida -->
<div class="bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
            <i data-lucide="user-cog" class="w-5 h-5 text-white"></i>
        </div>
        <div>
            <h3 class="font-semibold text-gray-800">Complete seu perfil</h3>
            <p class="text-sm text-gray-600">Atualize suas informações para encontrar as melhores vagas</p>
        </div>
    </div>
    <a href="{% url 'editar_perfil_candidato' %}" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition flex items-center gap-2">
        <i data-lucide="edit" class="w-4 h-4"></i>
        Editar Perfil
    </a>
</div>

<!-- Cards de Estatísticas -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="stat-card">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                <i data-lucide="zap" class="w-6 h-6 text-white"></i>
            </div>
        </div>
        <div class="stat-card-value">{{ matches.count|default:"0" }}</div>
        <div class="stat-card-label">Matches Ativos</div>
    </div>
    
    <div class="stat-card stat-card-secondary">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                <i data-lucide="file-text" class="w-6 h-6 text-white"></i>
            </div>
        </div>
        <div class="stat-card-value">12</div>
        <div class="stat-card-label">Candidaturas</div>
    </div>
    
    <div class="stat-card stat-card-success">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                <i data-lucide="video" class="w-6 h-6 text-white"></i>
            </div>
        </div>
        <div class="stat-card-value">3</div>
        <div class="stat-card-label">Entrevistas</div>
    </div>
    
    <div class="stat-card stat-card-accent">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                <i data-lucide="user-check" class="w-6 h-6 text-white"></i>
            </div>
        </div>
        <div class="stat-card-value">75%</div>
        <div class="stat-card-label">Perfil Completo</div>
    </div>
</div>

<!-- Grid Principal -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Coluna Principal -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Matches Recomendados -->
        <div class="card">
            <div class="card-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="card-title">Matches Recomendados</h2>
                        <p class="card-subtitle">Vagas perfeitas para o seu perfil</p>
                    </div>
                    <a href="{% url 'explorar_vagas' %}" class="btn btn-sm btn-primary">
                        Ver Todas
                    </a>
                </div>
            </div>
            
            <div class="space-y-4">
                {% if matches %}
                    {% for match in matches %}
                    <div class="job-card">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-start gap-4">
                                <div class="avatar avatar-lg bg-blue-100 text-blue-600">
                                    {{ match.vaga.empresa.nome.0|upper }}
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-900 text-lg">{{ match.vaga.titulo }}</h3>
                                    <p class="text-gray-600 text-sm">{{ match.vaga.empresa.nome }}</p>
                                    <p class="text-gray-500 text-sm mt-1">
                                        <i data-lucide="map-pin" class="w-4 h-4 inline"></i>
                                        {{ match.vaga.cidade }}, {{ match.vaga.estado }}
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                                    {{ match.score }}% Match
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            <span class="badge badge-gray">{{ match.vaga.get_tipo_display }}</span>
                            <span class="badge badge-gray">{{ match.vaga.get_nivel_display }}</span>
                            {% if match.vaga.salario_min and match.vaga.salario_max %}
                            <span class="badge badge-primary">R$ {{ match.vaga.salario_min }} - R$ {{ match.vaga.salario_max }}</span>
                            {% endif %}
                        </div>
                        
                        <div class="flex gap-2">
                            <a href="{% url 'detalhe_vaga' match.vaga.id %}" class="btn btn-sm btn-primary flex-1">
                                Ver Detalhes
                            </a>
                            <button class="btn btn-sm btn-secondary">
                                <i data-lucide="bookmark" class="w-4 h-4"></i>
                                Salvar
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i data-lucide="inbox" class="w-16 h-16"></i>
                        </div>
                        <h3 class="empty-state-title">Nenhum match encontrado</h3>
                        <p class="empty-state-text">Complete seu perfil para receber recomendações personalizadas</p>
                        <a href="{% url 'perfil_candidato' %}" class="btn btn-primary">
                            Completar Perfil
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Vagas Recentes -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Vagas Recentes</h2>
                <p class="card-subtitle">Últimas oportunidades publicadas</p>
            </div>
            
            <div class="space-y-3">
                {% for vaga in vagas_recentes %}
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <div class="flex items-center gap-3">
                        <div class="avatar avatar-md">{{ vaga.empresa.nome.0|upper }}</div>
                        <div>
                            <h4 class="font-semibold text-gray-900">{{ vaga.titulo }}</h4>
                            <p class="text-sm text-gray-600">{{ vaga.empresa.nome }} • {{ vaga.cidade }}</p>
                        </div>
                    </div>
                    <a href="{% url 'detalhe_vaga' vaga.id %}" class="btn btn-sm btn-ghost">
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </a>
                </div>
                {% empty %}
                <p class="text-center text-gray-500 py-8">Nenhuma vaga disponível no momento</p>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Coluna Lateral -->
    <div class="space-y-6">
        <!-- Progresso do Perfil -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Progresso do Perfil</h3>
            </div>
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-sm mb-2">
                        <span class="font-medium text-gray-700">Completude</span>
                        <span class="font-semibold text-blue-600">75%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: 75%"></div>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <div class="flex items-center gap-2 text-sm">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                        <span class="text-gray-700">Dados pessoais completos</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                        <span class="text-gray-700">Experiência adicionada</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <i data-lucide="circle" class="w-5 h-5 text-gray-300"></i>
                        <span class="text-gray-500">Adicionar foto</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <i data-lucide="circle" class="w-5 h-5 text-gray-300"></i>
                        <span class="text-gray-500">Completar habilidades</span>
                    </div>
                </div>
                
                <a href="{% url 'perfil_candidato' %}" class="btn btn-primary btn-full btn-sm">
                    Completar Perfil
                </a>
            </div>
        </div>
        
        <!-- Cursos Recomendados -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Cursos para Você</h3>
                <p class="card-subtitle">Desenvolva suas habilidades</p>
            </div>
            <div class="space-y-3">
                <div class="p-3 bg-purple-50 border border-purple-200 rounded-lg">
                    <h4 class="font-semibold text-gray-900 text-sm mb-1">Python Avançado</h4>
                    <p class="text-xs text-gray-600 mb-2">20 horas • Intermediário</p>
                    <a href="{% url 'cursos' %}" class="text-xs font-semibold text-purple-600 hover:text-purple-700">
                        Iniciar Curso →
                    </a>
                </div>
                
                <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-semibold text-gray-900 text-sm mb-1">React e TypeScript</h4>
                    <p class="text-xs text-gray-600 mb-2">15 horas • Avançado</p>
                    <a href="{% url 'cursos' %}" class="text-xs font-semibold text-blue-600 hover:text-blue-700">
                        Iniciar Curso →
                    </a>
                </div>
                
                <a href="{% url 'cursos' %}" class="btn btn-ghost btn-full btn-sm">
                    Ver Todos os Cursos
                </a>
            </div>
        </div>
        
        <!-- Assistente IA -->
        <div class="card bg-gradient-to-br from-indigo-500 to-purple-600 text-white">
            <div class="flex items-start gap-3">
                <div class="p-3 bg-white bg-opacity-20 rounded-lg">
                    <i data-lucide="bot" class="w-6 h-6"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-bold mb-2">Precisa de Ajuda?</h3>
                    <p class="text-sm text-indigo-100 mb-3">
                        Converse com nosso assistente de IA para orientação de carreira e dicas.
                    </p>
                    <a href="{% url 'chat_ia' %}" class="btn btn-sm" style="background-color: white; color: #6366F1;">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        Iniciar Chat
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
