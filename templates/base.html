{% load static %}
{% load user_tags %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TalentMatch!{% endblock %}</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50">

    <!-- Overlay para mobile -->
    <div class="sidebar-mobile-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <div class="flex min-h-screen">
        <!-- SIDEBAR -->
        <aside class="w-72 bg-white shadow-md flex flex-col fixed h-full z-20" id="sidebar">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-200">
                <a href="/" class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-blue-600">
                        <path d="M11.7 2.805a.75.75 0 0 1 .6 0A60.65 60.65 0 0 1 22.83 8.72a.75.75 0 0 1-.231 1.337 49.948 49.948 0 0 0-9.902 3.912l-.003.002c-.114.06-.227.119-.34.18a.75.75 0 0 1-.707 0A50.88 50.88 0 0 0 7.5 12.173v-.224c0-.131.067-.248.172-.311a54.615 54.615 0 0 1 4.653-2.52.75.75 0 0 0-.65-1.352 56.123 56.123 0 0 0-4.78 2.589 1.858 1.858 0 0 0-.859 1.228 49.803 49.803 0 0 0-4.634-1.527.75.75 0 0 1-.231-1.337A60.653 60.653 0 0 1 11.7 2.805Z" />
                        <path d="M13.06 15.473a48.45 48.45 0 0 1 7.666-3.282c.134 1.414.22 2.843.255 4.284a.75.75 0 0 1-.46.711 47.87 47.87 0 0 0-8.105 4.342.75.75 0 0 1-.832 0 47.87 47.87 0 0 0-8.104-4.342.75.75 0 0 1-.461-.71c.035-1.442.121-2.87.255-4.286.921.304 1.83.634 2.726.99v1.27a1.5 1.5 0 0 0-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.66a6.727 6.727 0 0 0 .551-1.607 1.5 1.5 0 0 0 .14-2.67v-.645a48.549 48.549 0 0 1 3.44 1.667 2.25 2.25 0 0 0 2.12 0Z" />
                        <path d="M4.462 19.462c.42-.419.753-.89 1-1.395.453.214.902.435 1.347.662a6.742 6.742 0 0 1-1.286 1.794.75.75 0 0 1-1.06-1.06Z" />
                    </svg>
                    <span class="text-2xl font-bold text-gray-800">TalentMatch!</span>
                </a>
            </div>

            <!-- Navegação -->
            <nav class="flex-1 p-4 space-y-1">
                {% if user.is_authenticated %}
                    {% if is_staff_only %}
                        <!-- Menu para Admin/Staff -->
                        <a href="{% url 'dashboard_admin' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard_admin' %}active{% endif %}">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                            <span>Dashboard Admin</span>
                        </a>
                        
                        <a href="{% url 'gerenciar_usuarios' %}" class="nav-link {% if request.resolver_match.url_name == 'gerenciar_usuarios' %}active{% endif %}">
                            <i data-lucide="users" class="w-5 h-5"></i>
                            <span>Gerenciar Usuários</span>
                        </a>
                        
                        <a href="{% url 'gerenciar_empresas' %}" class="nav-link {% if request.resolver_match.url_name == 'gerenciar_empresas' %}active{% endif %}">
                            <i data-lucide="building-2" class="w-5 h-5"></i>
                            <span>Gerenciar Empresas</span>
                        </a>
                        
                        <a href="{% url 'gerenciar_vagas' %}" class="nav-link {% if request.resolver_match.url_name == 'gerenciar_vagas' %}active{% endif %}">
                            <i data-lucide="briefcase" class="w-5 h-5"></i>
                            <span>Gerenciar Vagas</span>
                        </a>
                        
                        <a href="{% url 'painel_denuncias' %}" class="nav-link {% if request.resolver_match.url_name == 'painel_denuncias' %}active{% endif %}">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                            <span>Denúncias</span>
                        </a>
                        
                        <a href="{% url 'relatorios' %}" class="nav-link {% if request.resolver_match.url_name == 'relatorios' %}active{% endif %}">
                            <i data-lucide="bar-chart" class="w-5 h-5"></i>
                            <span>Relatórios</span>
                        </a>
                        
                        <a href="{% url 'config_admin' %}" class="nav-link {% if request.resolver_match.url_name == 'config_admin' %}active{% endif %}">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Configurações</span>
                        </a>
                    {% elif is_empresa %}
                        <!-- Menu para Empresa -->
                        <a href="{% url 'dashboard_empresa' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard_empresa' %}active{% endif %}">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                            <span>Dashboard</span>
                        </a>
                        
                        <a href="{% url 'perfil_empresa' %}" class="nav-link {% if request.resolver_match.url_name == 'perfil_empresa' %}active{% endif %}">
                            <i data-lucide="building-2" class="w-5 h-5"></i>
                            <span>Perfil da Empresa</span>
                        </a>
                        
                        <a href="{% url 'dashboard_empresa' %}#vagas" class="nav-link">
                            <i data-lucide="briefcase" class="w-5 h-5"></i>
                            <span>Minhas Vagas</span>
                        </a>
                        
                        <a href="{% url 'cadastrar_vaga' %}" class="nav-link {% if request.resolver_match.url_name == 'cadastrar_vaga' %}active{% endif %}">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i>
                            <span>Cadastrar Vaga</span>
                        </a>
                        
                        <a href="{% url 'listar_candidaturas_empresa' %}" class="nav-link {% if request.resolver_match.url_name == 'listar_candidaturas_empresa' %}active{% endif %}">
                            <i data-lucide="users" class="w-5 h-5"></i>
                            <span>Candidaturas Recebidas</span>
                        </a>
                        
                        <a href="{% url 'caixa_mensagens' %}" class="nav-link {% if request.resolver_match.url_name == 'caixa_mensagens' %}active{% endif %}">
                            <i data-lucide="mail" class="w-5 h-5"></i>
                            <span>Mensagens</span>
                        </a>
                        
                        <a href="{% url 'conf' %}" class="nav-link {% if request.resolver_match.url_name == 'conf' %}active{% endif %}">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Configurações</span>
                        </a>
                    {% else %}
                        <!-- Menu para Candidato -->
                        <a href="{% url 'dashboard_candidato' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard_candidato' %}active{% endif %}">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                            <span>Dashboard</span>
                        </a>
                        
                        <a href="{% url 'perfil_candidato' %}" class="nav-link {% if request.resolver_match.url_name == 'perfil_candidato' %}active{% endif %}">
                            <i data-lucide="user" class="w-5 h-5"></i>
                            <span>Meu Perfil</span>
                        </a>
                        
                        <a href="{% url 'explorar_vagas' %}" class="nav-link {% if request.resolver_match.url_name == 'explorar_vagas' %}active{% endif %}">
                            <i data-lucide="search" class="w-5 h-5"></i>
                            <span>Explorar Vagas</span>
                        </a>
                        
                        <a href="{% url 'candidaturas_vagas' %}" class="nav-link {% if request.resolver_match.url_name == 'candidaturas_vagas' %}active{% endif %}">
                            <i data-lucide="file-text" class="w-5 h-5"></i>
                            <span>Minhas Candidaturas</span>
                        </a>
                        
                        <a href="{% url 'caixa_mensagens' %}" class="nav-link {% if request.resolver_match.url_name == 'caixa_mensagens' %}active{% endif %}">
                            <i data-lucide="mail" class="w-5 h-5"></i>
                            <span>Mensagens</span>
                        </a>
                        
                        <a href="{% url 'chat_ia' %}" class="nav-link {% if request.resolver_match.url_name == 'chat_ia' %}active{% endif %}">
                            <i data-lucide="bot" class="w-5 h-5"></i>
                            <span>Assistente IA</span>
                        </a>
                        
                        <a href="{% url 'cursos' %}" class="nav-link {% if request.resolver_match.url_name == 'cursos' %}active{% endif %}">
                            <i data-lucide="graduation-cap" class="w-5 h-5"></i>
                            <span>Cursos</span>
                        </a>
                        
                        <a href="{% url 'conf' %}" class="nav-link {% if request.resolver_match.url_name == 'conf' %}active{% endif %}">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>Configurações</span>
                        </a>
                    {% endif %}
                {% endif %}
            </nav>

            <!-- Rodapé da Sidebar -->
            <div class="border-t border-gray-200 p-4">
                <a href="{% url 'logout' %}" class="nav-link text-red-600 hover:bg-red-50">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    <span>Sair</span>
                </a>
            </div>
        </aside>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="flex-1 ml-72">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
                <div class="px-4 lg:px-8 py-6">
                    <div class="flex justify-between items-center">
                        <!-- Botão Menu Mobile -->
                        <button class="mobile-only p-2 text-gray-600 hover:bg-gray-100 rounded-lg mr-3" onclick="toggleSidebar()" aria-label="Menu">
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>
                        
                        <div class="flex-1">
                            <h1 class="text-xl lg:text-2xl font-bold text-gray-900">
                                {% block page_title %}Dashboard{% endblock %}
                            </h1>
                            <p class="text-xs lg:text-sm text-gray-500 mt-1">
                                {% block page_subtitle %}Bem-vindo ao TalentMatch!{% endblock %}
                            </p>
                        </div>
                        
                        <div class="flex items-center gap-4">
                            <!-- Notificações -->
                            <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                                <i data-lucide="bell" class="w-5 h-5"></i>
                                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                            
                            <!-- Avatar do Usuário -->
                            <div class="flex items-center gap-3">
                                <div class="text-right">
                                    <p class="text-sm font-semibold text-gray-900">
                                        {% if is_empresa %}
                                            {{ user_empresa.nome }}
                                        {% elif is_candidato %}
                                            {{ user_candidato.nome }}
                                        {% else %}
                                            {{ user.get_full_name|default:user.username }}
                                        {% endif %}
                                    </p>
                                    <p class="text-xs text-gray-500">
                                        {% if is_staff_only %}
                                            Administrador
                                        {% elif is_empresa %}
                                            Empresa
                                        {% elif is_candidato %}
                                            Candidato
                                        {% else %}
                                            {% block user_role %}Usuário{% endblock %}
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="avatar avatar-md">
                                    {% if is_empresa %}
                                        {{ user_empresa.nome.0|upper }}
                                    {% elif is_candidato %}
                                        {{ user_candidato.nome.0|upper }}
                                    {% else %}
                                        {{ user.username.0|upper }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Mensagens do Django -->
            {% if messages %}
            <div class="px-8 pt-6">
                {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} animate-fadeIn">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Conteúdo da Página -->
            <div class="p-8">
                {% block content %}
                {% endblock %}
            </div>
        </main>
    </div>

    <script>
        // Inicializar ícones Lucide
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
        
        // Toggle sidebar mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }
        
        // Auto-fechar alertas após 5 segundos
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
